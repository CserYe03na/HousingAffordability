[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "NYC Housing Affordability and Vacancy Pattern Exploratory Data Analysis",
    "section": "",
    "text": "1 Introduction\nHousing affordability has been a major issue in many U.S. cities, especially in New York, where the population is very dense and people move frequently. Vacancy rates help us to understand both the housing market and how people make housing choices. When the vacancy rate is very low, it can mean that there are not enough affordable units and renters face strong competition. When the vacancy rate goes up, it may show changes in neighborhood desirability, unit conditions, or even broader economic trends.\nIn this project, we use data from 1991 to 2017, including occupancy status (OCC), household weights, rent, and income, to study how NYC’s vacancy patterns have changed over time. First, we describe the overall vacancy trends across boroughs and neighborhoods. Then, we look at structural factors related to vacancy, such as affordability, rent levels, and physical housing characteristics. We use tools like vacancy reason distributions and PCA to identify important patterns. Finally, we examine how demographic groups and income levels relate to different housing choices, and how vacancy trends connect to broader affordability indicators like housing burden or the rent–income ratio.\nOverall, our goal is to better understand how market forces, housing conditions, and residents’ preferences together shape the occupancy patterns in New York City.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "2  Data",
    "section": "",
    "text": "2.1 Description\nThe main data source for this project is the New York City Department of Housing Preservation and Development (HPD), which publishes housing research datasets through its official website (https://www.nyc.gov/site/hpd/about/research.page). The data are collected by HPD using long-term housing surveys and administrative records. For this project, we use data from 1991 to 2017, focusing on variables such as occupancy status (OCC), final household weight, borough, monthly gross rent, and total household income. These variables allow us to compute the weighted vacancy rate and analyze affordability trends over time. The datasets are provided in tabular format, and the update frequency varies across survey years. One important limitation is that, for privacy protection, some detailed household-level information is masked or aggregated, which may reduce the precision of certain analyses. Another data challenge is that variable names and column formats are not fully consistent across different years, so additional cleaning and standardization are required to align the datasets for time-series analysis. All data used in this project are sourced directly from the NYC HPD research portal.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#missing-value-analysis",
    "href": "data.html#missing-value-analysis",
    "title": "2  Data",
    "section": "2.2 Missing value analysis",
    "text": "2.2 Missing value analysis\n\n\nCode\nlibrary(tidyverse)   \nlibrary(janitor)     \nlibrary(scales)      \nlibrary(viridis)\n\nocc_before &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/occupied_all_years.csv\") |&gt; clean_names()\nvac_before &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/vacant_all_years.csv\")   |&gt; clean_names()\n\npuf21 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/allunits_puf_21.csv\") |&gt; clean_names()\nvac21 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/vacant_puf_21.csv\") |&gt; clean_names()\nperson21 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/person_puf_21.csv\") |&gt; clean_names()\nocc21     &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/occupied_puf_21.csv\")   |&gt; clean_names()\n\npuf23 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/allunits_puf_23.csv\") |&gt; clean_names()\nvac23 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/vacant_puf_23.csv\") |&gt; clean_names()\nperson23 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/person_puf_23.csv\") |&gt; clean_names()\nocc23     &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/occupied_puf_23.csv\")   |&gt; clean_names()\n\n\n\n\nCode\n## Missing Value Exploration\ndatasets &lt;- list(\n  occ_before = occ_before,\n  vac_before = vac_before,\n  puf21 = puf21,\n  vac21 = vac21,\n  person21 = person21,\n  occ21 = occ21,\n  puf23 = puf23,\n  vac23 = vac23,\n  person23 = person23,\n  occ23 = occ23\n)\n\nna_summary &lt;- lapply(names(datasets), function(nm) {\n  df &lt;- datasets[[nm]]\n  data.frame(\n    dataset = nm,\n    total_rows = nrow(df),\n    total_cols = ncol(df),\n    total_NA = sum(is.na(df)),\n    rows_with_NA = sum(!complete.cases(df))\n  )\n})\n\nna_summary_df &lt;- bind_rows(na_summary)\nna_summary_df\n\n\n      dataset total_rows total_cols total_NA rows_with_NA\n1  occ_before     140813          5        0            0\n2  vac_before      12578          4        0            0\n3       puf21       8394        105        0            0\n4       vac21       1305         91        0            0\n5    person21      15585        179        0            0\n6       occ21       7089        232        0            0\n7       puf23       9597        116        0            0\n8       vac23        821         88        0            0\n9    person23      20458        204        0            0\n10      occ23       8776        250        0            0\n\n\nThe table shows that none of the NYCHVS datasets contain explicit NA values—every cell is filled. However, this does not mean the data are complete. NYCHVS encodes missing or inapplicable responses directly within variable values, using codes such as –1 (“not reported”), 9999 / 99999 (rent not applicable), and 999999 / 9999999 (income not reported or no income).\nBecause the datasets contain hundreds of variables, identifying all encoded missing-value formats would be unnecessarily complex. Instead, we focus on variables directly relevant to our analysis (rent, income, mortgage, vacancy), apply the official NYCHVS coding rules, and convert only these value-encoded codes into proper missing values. This targeted approach allows us to capture meaningful missingness patterns without recoding the full data dictionary.\n\n\nCode\n## Due to the high volume of the variables, we only explore missing values existed in the variables we used below analysis\n# ---------- 21 & 23 datasets ----------\nperson21_miss &lt;- person21 |&gt;\n  mutate(\n    missing_income = total_inc_rec_p == -2222222222\n  ) |&gt;\n  count(missing_income)\n\nocc21_miss &lt;- occ21 |&gt;\n  mutate(\n    missing_rent = rent_amount == -2\n  ) |&gt;\n  count(missing_rent)\n\nperson23_miss &lt;- person23 |&gt;\n  mutate(\n    missing_income = total_inc_p == -2222222222\n  ) |&gt;\n  count(missing_income)\n\nhh23_miss &lt;- occ23 |&gt;\n  mutate(\n    missing_rent = rent_amount == -2\n  ) |&gt;\n  count(missing_rent)\n\n# ---------- 91–17 dataset -----------\ndf_91_17_missing &lt;- occ_before |&gt;\n  mutate(\n    inc  = as.numeric(inc),\n    rent = as.numeric(rent),\n    year = as.numeric(year),\n\n    # missing_income is TRUE when logic makes inc == NA\n    missing_income = case_when(\n      year &lt;= 1996 & inc == 999999  ~ FALSE,   # becomes 0 → not missing\n      year &lt;= 2002 & inc == 9999999 ~ FALSE,   # becomes 0 → not missing\n      inc &gt; 999997                  ~ TRUE,    # missing\n      TRUE ~ FALSE\n    ),\n\n    # missing_rent according to your rules\n    missing_rent = case_when(\n      year == 1991  & rent %in% c(9999, 9998) ~ TRUE,\n      year &lt;= 2010  & rent == 9999            ~ TRUE,\n      year &gt;= 2011  & rent == 99999           ~ TRUE,\n      TRUE ~ FALSE\n    )\n  ) |&gt;\n  summarise(\n    total = n(),\n    missing_income = sum(missing_income),\n    missing_rent   = sum(missing_rent)\n  )\nmissing_plot &lt;- occ_before |&gt;\n  mutate(\n    inc  = as.numeric(inc),\n    rent = as.numeric(rent),\n    year = as.numeric(year),\n\n    missing_income = case_when(\n      year &lt;= 1996 & inc == 999999  ~ FALSE,\n      year &lt;= 2002 & inc == 9999999 ~ FALSE,\n      inc &gt; 999997                  ~ TRUE,\n      TRUE ~ FALSE\n    ),\n    missing_rent = case_when(\n      year == 1991  & rent %in% c(9999, 9998) ~ TRUE,\n      year &lt;= 2010  & rent == 9999            ~ TRUE,\n      year &gt;= 2011  & rent == 99999           ~ TRUE,\n      TRUE ~ FALSE\n    )\n  ) |&gt;\n  group_by(year) |&gt;\n  summarise(\n    missing_income_rate = mean(missing_income),\n    missing_rent_rate   = mean(missing_rent)\n  )|&gt;\n  pivot_longer(\n    cols = c(missing_income_rate, missing_rent_rate),\n    names_to = \"variable\",\n    values_to = \"missing_rate\"\n  )\n\nggplot(missing_plot, aes(x = factor(year), y = missing_rate, fill = variable)) +\n  geom_col(position = \"dodge\") +\n  scale_fill_manual(\n    values = c(\"missing_income_rate\" = \"red\", \"missing_rent_rate\" = cividis(3)[1]),\n    labels = c(\"missing_income_rate\" = \"Missing Income\", \"missing_rent_rate\"   = \"Missing Rent\"))+\n  scale_y_continuous(labels = scales::percent_format()) +\n  labs(\n    title = \"Missing Value Percentage by Year\",\n    x = \"Year\",\n    y = \"Missing Percentage\",\n    fill = \"Variable\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nAlthough the plot shows that contract rent has a relatively high “missing” rate across survey years, this missingness does not indicate true nonresponse. In the NYCHVS microdata, rent is coded as Not Applicable for households that are owner-occupied or occupied rent-free, meaning these units legitimately do not report a rent amount. Because our rent-based affordability analysis focuses specifically on renter households, these Not-Applicable entries are treated as NA in the rent variable. The apparent 30–38% “missing rent” therefore reflects the share of non-renter households rather than measurement error.\nImportantly, these units are not dropped from analysis altogether. Instead, owner-occupied households are incorporated separately through mortgage payment variables, allowing us to evaluate affordability for owners using mortgage burden rather than rent burden. Thus, the high missing rate in the rent field should be interpreted as a structural feature of housing tenure distributions rather than a data quality issue. This distinction ensures that the treatment of missing values aligns with the analytical design: renters are assessed using rent-to-income ratios, while owners are evaluated using mortgage-to-income ratios, providing parallel and internally consistent affordability measures for both groups.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "results.html",
    "href": "results.html",
    "title": "3  Results",
    "section": "",
    "text": "This project looks at how housing vacancy and affordability have changed in New York City over time. Even though people often talk about “empty apartments,” our findings show that NYC’s vacancy rate has stayed low for more than 30 years, and only spiked briefly in 2021. When we map vacancy across neighborhoods, we see that higher vacancy is concentrated in parts of Manhattan, while most other areas remain very tight. To understand why vacant units are not available, we examined the reported reasons. Most units are unavailable because of renovations, seasonal use, or multiple overlapping issues—not because they are intentionally kept off the market. This suggests that the city’s main housing challenge is not unused supply, but rather limited availability caused by structural and practical constraints. We also looked at what kinds of housing units tend to be vacant. Basic building features—like number of rooms, stories, and building size—show some patterns, but they do not strongly explain vacancy on their own. Affordability, however, shows a much clearer story. Rent in NYC has grown much faster than income since the early 1990s, and low-income renters are especially likely to be severely rent-burdened. Even middle-income renters face rising pressure. When we compare affordability with vacancy, we find no strong link: places with expensive housing do not necessarily have higher vacancy. Instead, affordability problems exist even when the market is extremely tight. Overall, the findings suggest that NYC’s housing issues are driven less by “too many vacant apartments” and much more by a long-term mismatch between rent growth and income growth, combined with limited rental supply and structural barriers that keep some units offline. This helps explain why affordability remains one of the city’s biggest challenges.\n\n\nCode\n# All needed library\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(tidycensus)\nlibrary(sf)\nlibrary(dplyr)\nlibrary(tmap)\nlibrary(FactoMineR)\nlibrary(factoextra)\nlibrary(ggplot2)\nlibrary(ggalluvial)\nlibrary(viridis)\nlibrary(fredr)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(ggrepel)\nlibrary(vcd)\n\n\n\n\nCode\n# Read data from csv\n# This two csv files come from the extraction by pdf_extract_occupied.py (occupied_layout.csv & vacant_layout.csv are needed as well)\nocc_before &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/occupied_all_years.csv\") |&gt; clean_names()\nvac_before &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/vacant_all_years.csv\")   |&gt; clean_names()\n\npuf21 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/allunits_puf_21.csv\") |&gt; clean_names()\nvac21 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/vacant_puf_21.csv\") |&gt; clean_names()\nperson21 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/person_puf_21.csv\") |&gt; clean_names()\nocc21     &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/occupied_puf_21.csv\")   |&gt; clean_names()\n\npuf23 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/allunits_puf_23.csv\") |&gt; clean_names()\nvac23 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/vacant_puf_23.csv\") |&gt; clean_names()\nperson23 &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/person_puf_23.csv\") |&gt; clean_names()\nocc23     &lt;- read_csv(\"/Users/serenacyn03/HousingAffordability/data_raw/occupied_puf_23.csv\")   |&gt; clean_names()\n\n\n\n\nCode\nvac_occ1 &lt;- vac_before |&gt;\n  filter(occ == 1) |&gt;\n  group_by(boro, year) |&gt;\n  summarise(\n    vac_fw = sum(fw, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nocc_sum &lt;- occ_before |&gt;\n  group_by(boro, year) |&gt;\n  summarise(\n    occ_fw = sum(fw, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nrate_91_17 &lt;- vac_occ1 |&gt;\n  full_join(occ_sum, by = c(\"boro\", \"year\")) |&gt;\n  mutate(\n    occ_fw = replace_na(occ_fw, 0),\n    vac_fw = replace_na(vac_fw, 0),\n    vacancy_rate = vac_fw / (occ_fw + vac_fw)\n  ) |&gt;\n  arrange(boro, year)\n\nhead(rate_91_17)\n\n\n# A tibble: 6 × 5\n   boro  year vac_fw  occ_fw vacancy_rate\n  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;\n1     1  1991 14169. 410235.       0.0334\n2     1  1993 14044. 411706.       0.0330\n3     1  1996 19055. 411775.       0.0442\n4     1  2002 12364. 462878.       0.0260\n5     1  2005  9952. 472246.       0.0206\n6     1  2008 12758. 479990.       0.0259\n\n\n\n\nCode\nrate_21 &lt;- puf21 |&gt;\n  filter(occ %in% c(1, 2)) |&gt;     # keep rental market units\n  mutate(year = 2021) |&gt;\n  group_by(boro, year) |&gt;\n  summarise(\n    vac_fw = sum(fw[occ == 2], na.rm = TRUE),\n    occ_fw = sum(fw[occ == 1], na.rm = TRUE),\n    vacancy_rate = vac_fw / (vac_fw + occ_fw),\n    .groups = \"drop\"\n  )\n\nrate_23 &lt;- puf23 |&gt;\n  filter(occ %in% c(1, 2)) |&gt;  \n  mutate(year = 2023) |&gt;\n  group_by(boro, year) |&gt;\n  summarise(\n    vac_fw = sum(fw[occ == 2], na.rm = TRUE),\n    occ_fw = sum(fw[occ == 1], na.rm = TRUE),\n    vacancy_rate = vac_fw / (vac_fw + occ_fw),\n    .groups = \"drop\"\n  )\n\nrate_91_23 &lt;- bind_rows(rate_91_17, rate_21, rate_23) |&gt;\n  arrange(boro, year) |&gt;\n  mutate(\n    boro_name = recode(\n      as.character(boro),\n      \"1\" = \"Bronx\",\n      \"2\" = \"Brooklyn\",\n      \"3\" = \"Manhattan\",\n      \"4\" = \"Queens\",\n      \"5\" = \"Staten Island\"\n    ),\n    boro_name = factor(\n      boro_name,\n      levels = c(\"Bronx\", \"Brooklyn\", \"Manhattan\", \"Queens\", \"Staten Island\")\n    )\n  )\n\nhead(rate_91_23)\n\n\n# A tibble: 6 × 6\n   boro  year vac_fw  occ_fw vacancy_rate boro_name\n  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt; &lt;fct&gt;    \n1     1  1991 14169. 410235.       0.0334 Bronx    \n2     1  1993 14044. 411706.       0.0330 Bronx    \n3     1  1996 19055. 411775.       0.0442 Bronx    \n4     1  2002 12364. 462878.       0.0260 Bronx    \n5     1  2005  9952. 472246.       0.0206 Bronx    \n6     1  2008 12758. 479990.       0.0259 Bronx    \n\n\n\n\nCode\n# Plot1.1: Vacancy rate overview by year by borough\nyears_present &lt;- sort(unique(rate_91_23$year))\n\nrate_91_23_plot &lt;- rate_91_23 %&gt;%\n  mutate(year_f = factor(year, levels = years_present))\n\nggplot(rate_91_23_plot,\n       aes(\n         x = year_f,\n         y = vacancy_rate,\n         color = boro_name,\n         group = boro_name\n       )) +\n  geom_line(linewidth = 1.1) +\n  geom_point(size = 2) +\n  scale_color_viridis_d(option = \"cividis\", name = \"Borough\") +\n  labs(\n    title = \"NYC Vacancy Rate by Borough, 1991–2023\",\n    x = \"Year\",\n    y = \"Vacancy Rate\"\n  ) +\n  theme_minimal() +\n  theme(\n    panel.grid.minor = element_blank(),\n    axis.text.x = element_text(angle = 45, hjust = 1)\n  )\n\n\n\n\n\n\n\n\n\nThis figure shows the long-run vacancy rate trends across New York City’s five boroughs. Overall, vacancy rates remain consistently low throughout the entire period, which suggests that NYC has persistent housing supply pressure for more than three decades. Most boroughs fluctuate within a narrow range of 1% to 4%, indicating a tight housing market rather than a market experiencing oversupply. The Bronx shows a noticeable peak in the mid-1990s, reaching above 4%, followed by a sharp decline in the early 2000s. This pattern may reflect earlier periods of disinvestment and later recovery. Manhattan shows the largest fluctuation in the later years, with a sharp spike in 2021 when vacancy rose to nearly 8%, followed by a rapid return to historically low levels by 2023. This unusual jump is likely related to short-term disruptions such as the COVID-19 pandemic rather than long-term structural changes in housing supply. Queens also experiences a temporary increase in vacancy around 2021, though to a much smaller extent, and quickly returns to very low levels. Staten Island remains the most stable borough throughout the period, with consistently low vacancy and minimal fluctuations. By 2023, vacancy rates across all five boroughs fall below 1%, highlighting an extremely tight post-pandemic housing market.\n\n\nCode\noptions(tigris_use_cache = TRUE)\n\n# download ACS Tract-Level Vacancy Data\nnyc_tract_vacancy &lt;- get_acs(\n  geography = \"tract\",\n  state = \"NY\",\n  county = c(\"005\", \"047\", \"061\", \"081\", \"085\"),\n  year = 2023,\n  survey = \"acs5\",\n  variables = c(\n    total_units  = \"B25002_001\",\n    vacant_units = \"B25002_003\"\n  ),\n  geometry = TRUE,\n  output = \"wide\"\n)\n\n# vacancy Rate\nnyc_tract_vacancy &lt;- nyc_tract_vacancy |&gt;\n  mutate(\n    vacancy_rate = vacant_unitsE / total_unitsE,\n    borough_fips = substr(GEOID, 3, 5)\n  ) |&gt;\n  filter(!is.na(vacancy_rate), total_unitsE &gt; 0)\n\n#Create Borough Boundary by Union \nnyc_boroughs_union &lt;- nyc_tract_vacancy |&gt;\n  group_by(borough_fips) |&gt;\n  summarize(geometry = st_union(geometry)) |&gt;\n  st_as_sf() |&gt;\n  mutate(\n    borough = recode(\n      borough_fips,\n      \"005\" = \"Bronx\",\n      \"047\" = \"Brooklyn\",\n      \"061\" = \"Manhattan\",\n      \"081\" = \"Queens\",\n      \"085\" = \"Staten Island\"\n    )\n  )\n\n\n\n\nCode\n# Plot1.2: NYC ACS Vacancy Choropleth with Borough Boundary\n#| fig-width: 12\ntmap_mode(\"plot\")\n\ntm_shape(nyc_tract_vacancy) +\n  tm_fill(\n    \"vacancy_rate\",\n    palette = \"cividis\",\n    style = \"jenks\",\n    n = 5, \n    title = \"Vacancy Rate\"\n  ) +\n  tm_shape(nyc_boroughs_union) +\n  tm_borders(col = \"red\", lwd = 1) +\n  tm_layout(\n    title = \"Vacancy Rate by Tract with Borough Boundary in 2023\",\n    legend.outside = TRUE,\n    frame = FALSE\n  )\n\n\n\n\n\n\n\n\n\nThis map illustrates the spatial distribution of vacancy rates across New York City at the census tract level in 2023. Most tracts across the city fall within the lowest vacancy range, indicating that the overall housing market remains extremely tight. However, there are clear geographic differences in where the remaining vacancies are concentrated. Manhattan shows the most noticeable cluster of higher-vacancy tracts, particularly around Midtown and parts of the Upper East Side and Lower Manhattan. These localized pockets stand out sharply compared with the rest of the city, suggesting that vacancy in 2023 is not evenly distributed across Manhattan but concentrated in specific neighborhoods. Queens also contains a few isolated tracts with comparatively elevated vacancy, appearing mainly near Long Island City and in some outer areas. In contrast, the Bronx, Brooklyn, and Staten Island remain almost entirely within the lowest vacancy categories, showing limited spatial variation. Overall, the map highlights that even in a year with historically low citywide vacancy, certain neighborhoods—especially in Manhattan—display higher levels of unoccupied units, while most residential areas across NYC maintain very limited vacancy.\n\n\nCode\n# Plot2.1: Vacancy Reason Distribution Bar Chart\nreason_labels &lt;- c(\n  \"-2\" = \"Not Applicable (Available/Owner-prev)\",\n  \"-1\" = \"Not Reported\",\n  \"1\"  = \"Under Renovation\",\n  \"2\"  = \"Seasonal/Occasional Use\",\n  \"3\"  = \"Additional Structural/Legal Reasons\",\n  \"4\"  = \"Held as Vacant\",\n  \"5\"  = \"Multiple Reasons Reported\"\n)\n\nvac23$reason_label &lt;- factor(\n  vac23$reason_notavail,\n  levels = c(-2, -1, 1, 2, 3, 4, 5),\n  labels = reason_labels\n)\n\nvac23 |&gt;\n  count(reason_label) |&gt;\n  ggplot(aes(x = n, y = reorder(reason_label, n))) +\n  geom_col(fill = viridisLite::cividis(6)[2]) +\n  labs(\n    title = \"Distribution of Reasons for Units Being Not Available in 2023\",\n    x = \"Count\",\n    y = \"Reason\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nThis bar chart shows the distribution of reported reasons why vacant housing units are not available for rent. The largest category is “multiple reasons reported,” indicating that many vacant units face more than one constraint at the same time, such as renovation needs combined with legal or structural issues. This highlights the complexity behind housing vacancy and suggests that many units are kept off the market due to overlapping barriers rather than a single cause. Seasonal or occasional use is the second most common reason, which suggests that a significant portion of vacancies are associated with second homes, temporary occupancy, or infrequent usage. These units are technically vacant but are not intended to be part of the long-term rental supply. Units under renovation also represent a substantial share of unavailable housing, showing that short-term construction and improvement activities temporarily reduce market supply. Structural or legal reasons further limit availability, reflecting the role of regulatory and physical constraints in shaping vacancy. In contrast, relatively few units are reported as being intentionally held vacant. Overall, this distribution suggests that most vacancy in the market is driven by practical factors rather than by holding of housing from renters.\n\n\nCode\nvacall_23 &lt;- vac23 |&gt;\n  inner_join(puf23, by = \"control\", suffix = c(\"_vac\", \"_all\"))\n\n\n\n\nCode\n# Plot2.2: PCA Biplot for structural factors behind vacancy \npca_vars &lt;- vacall_23 |&gt;\n  transmute(\n    lastrent = as.numeric(lastrent),\n    yearbuilt = as.numeric(yearbuilt),\n    stories = as.numeric(stories),\n    unit_floor = as.numeric(unit_floor),\n    rooms = as.numeric(rooms),\n    bedrooms = as.numeric(bedrooms),\n    fullbath_num = as.numeric(fullbath_num),\n    halfbath_num = as.numeric(halfbath_num),\n    units = as.numeric(units),\n    condocoop = as.numeric(condocoop),\n    elevator = as.numeric(elevator)\n  )\n\n# clean lastrent & log transform\npca_vars &lt;- pca_vars |&gt;\n  mutate(\n    lastrent_num = ifelse(lastrent &gt; 0, lastrent, NA_real_),\n    log_lastrent = log1p(lastrent_num),\n    log_units = log1p(units)\n  ) |&gt;\n  select(\n    log_lastrent, yearbuilt, stories, unit_floor, rooms,\n    bedrooms, fullbath_num, halfbath_num, log_units,\n    condocoop, elevator\n  )\n\n# fill na with median \npca_vars &lt;- pca_vars |&gt;\n  mutate(across(everything(), ~ ifelse(is.na(.x), median(.x, na.rm=TRUE), .x)))\n\n# PCA\npca_res &lt;- PCA(pca_vars, scale.unit = TRUE, graph = FALSE)\n\nfviz_pca_biplot(\n  pca_res,\n  repel = TRUE,\n  geom.ind = \"point\",\n  label = \"var\",\n  col.var = viridisLite::cividis(6)[2],     \n  col.ind = \"grey\", \n) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\nThis biplot shows the main structural differences among vacant housing units using two principal components. The first dimension (PC1, x-axis) mainly reflects overall building scale and vertical form. On the right side of the x-axis, variables such as log units, year built, number of stories, and unit floor level load positively. This means units on the right side tend to be in larger, taller, and newer buildings, and are located on higher floors. In contrast, on the left side of the x-axis, elevator and condo/co-op load in the opposite direction, which suggests a different building type structure, often related to lower-rise or non–high-density residential forms. The second dimension (PC2, y-axis) is mainly driven by interior unit features, including number of rooms, number of bedrooms, and number of bathrooms. Units with higher values on PC2 tend to have larger interior space and more amenities, while units with lower PC2 values are more compact and have fewer interior features. Overall, this biplot shows that vacant housing units in NYC differ mainly along two structural dimensions: (1) building scale and vertical structure, and (2) interior unit size and amenities. While this PCA helps summarize the structural heterogeneity among vacant units, it does not by itself establish a direct causal relationship between these structural features and vacancy. Instead, it provides visual evidence that vacant units in 2023 vary widely in both building type and interior characteristics.\n\n\nCode\nrace_majority &lt;- person23 |&gt;\n  mutate(\n    race_group = case_when(\n      race_p == 1 ~ \"W\",\n      race_p == 2 ~ \"B\",\n      race_p == 3 ~ \"N\",\n      race_p == 4 ~ \"A\",\n      race_p == 5 ~ \"I\",\n      race_p == 6 ~ \"Other\"\n    )\n  )|&gt;\n  count(control, race_group, name = \"race_n\") |&gt;\n  group_by(control) |&gt;\n  slice_max(order_by = race_n, n = 1, with_ties = FALSE) |&gt;\n  ungroup() |&gt;\n  rename(hh_race = race_group)\n\n\n\n\nCode\nage_mean &lt;- person23 |&gt;\n  group_by(control) |&gt;\n  summarise(mean_age = mean(age_rec_p, na.rm = TRUE), .groups = \"drop\")\n\n\n\n\nCode\nhousehold_type &lt;- person23 |&gt;\n  group_by(control) |&gt;\n  summarise(\n    n_person = n(),\n    has_spouse = any(relation_p %in% c(1,2)),\n    has_child = any(relation_p == 3),\n    has_ext = any(relation_p %in% c(4,5,6,7,8,9)),\n    has_nonfamily = any(relation_p %in% c(10,11)),\n    .groups = \"drop\"\n  ) |&gt;\n  mutate(\n    hh_type = case_when(\n      n_person == 1 ~ \"Single\",\n      has_spouse ~ \"Married\",\n      !has_spouse & has_child ~ \"Single-parent\",\n      has_ext ~ \"Extended\",\n      has_nonfamily ~ \"Nonfamily\",\n      TRUE ~ \"Other\"\n    )\n  )\n\n\n\n\nCode\nhh_df &lt;- race_majority |&gt;\n  left_join(age_mean, by = \"control\") |&gt;\n  left_join(household_type |&gt; select(control, hh_type), by = \"control\") |&gt;\n  left_join(occ23 |&gt; select(control, rent_amount, hhinc_rec1, fw), by = \"control\")\n\n\n\n\nCode\nincome_bins &lt;- function(h) {\n  case_when(\n    h &lt; 25000 ~ \"&lt;25k\",\n    h &lt; 50000 ~ \"25k-49k\",\n    h &lt; 100000 ~ \"50k-99k\",\n    h &gt;= 100000 ~ \"100k+\",\n    TRUE ~ NA_character_\n  )\n}\n\nrent_bins &lt;- function(r) {\n  case_when(\n    r &lt; 500 ~ \"&lt;500\",\n    r &lt; 1000 ~ \"&lt;1k\",\n    r &lt; 1500 ~ \"&lt;1.5k\",\n    r &lt; 2000 ~ \"&lt;2k\",\n    r &lt; 3000 ~ \"&lt;3k\",\n    TRUE ~ \"3k+\"\n  )\n}\n\nhh_df &lt;- hh_df |&gt;\n  mutate(\n    income_bracket = income_bins(hhinc_rec1),\n    rent_bracket   = rent_bins(rent_amount),\n    age_group = case_when(\n      mean_age &lt; 35 ~ \"18–34\",\n      mean_age &lt; 55 ~ \"35–54\",\n      mean_age &lt; 65 ~ \"55–64\",\n      TRUE ~ \"65+\"\n    )\n  )\n\n\n\n\nCode\ndf_cat &lt;- hh_df |&gt;\n  select(rent_bracket, hh_race, age_group, hh_type, income_bracket) |&gt;\n  mutate(across(everything(), factor))\n\ntab &lt;- structable(~ rent_bracket + hh_race + age_group + hh_type + income_bracket,\n                  data = df_cat)\n\npairs(tab,\n      shade = TRUE,\n      gap = 0.2,\n      main = \"Mosaic Pairs: Household Demographics vs Rent Levels (NYCHVS 2023)\")\n\n\n\n\n\n\n\n\n\n\n\nCode\nperson23_clean &lt;- person23 |&gt;\n  mutate(\n    total_inc_p = na_if(total_inc_p, -2222222222)  # non-applicable → NA\n  )\n\nhh_df23_clean &lt;- hh_df |&gt;\n  mutate(\n    rent_amount = na_if(rent_amount, -2)  # non-applicable → NA\n  )\n\nincome_household23 &lt;- person23_clean |&gt;\n  group_by(control) |&gt;\n  summarise(\n    hh_income = sum(total_inc_p, na.rm = TRUE),\n    fw = first(pw),\n    .groups = \"drop\"\n  )\n\n\n\n\nCode\nowner23 &lt;- occ23 |&gt;\n  clean_names() |&gt;\n  mutate(\n    # clean mortgage payment\n    mfirstmort = na_if(mfirstmort, -1),\n    mfirstmort = na_if(mfirstmort, -2),\n    mfirstmort = na_if(mfirstmort, -3)\n  ) |&gt;\n  left_join(income_household23 |&gt; select(control, hh_income),\n            by = \"control\") |&gt;\n  mutate(\n    mortgage_burden = (mfirstmort * 12) / hh_income,\n    cost_burden = case_when(\n      mortgage_burden &lt; 0.30 ~ \"Not burdened (&lt;30%)\",\n      mortgage_burden &lt; 0.50 ~ \"Moderately burdened (30–49%)\",\n      mortgage_burden &gt;= 0.50 ~ \"Severely burdened (50%+)\",\n      TRUE ~ NA_character_\n    ),\n    \n    income_bracket = case_when(\n      hh_income &lt; 25000 ~ \"&lt;$25k\",\n      hh_income &lt; 50000 ~ \"$25k–$49k\",\n      hh_income &lt; 100000 ~ \"$50k–$99k\",\n      hh_income &gt;= 100000 ~ \"$100k+\",\n      TRUE ~ NA_character_\n    ),\n\n    tenure = \"Owner with mortgage\"\n  ) |&gt;\n  select(control, fw, mortgage_burden, cost_burden, income_bracket, tenure) |&gt;\n  filter(!is.na(cost_burden), !is.na(income_bracket))\n\n\n\n\nCode\nboro_lookup23 &lt;- puf23 |&gt; \n  select(control, boro) |&gt; \n  distinct()\n\ndf23 &lt;- hh_df23_clean |&gt;\n  left_join(boro_lookup23, by = \"control\") |&gt;\n  left_join(income_household23 |&gt; select(control, hh_income, fw), by = \"control\") |&gt;\n  mutate(\n    fw = coalesce(`fw.x`, `fw.y`),   # 优先 household weight，没有就用 income weight\n    annual_rent = rent_amount * 12,\n    income_for_burden = if_else(hh_income &lt;= 0 | is.na(hh_income),\n                                NA_real_, hh_income),\n    rent_to_income = annual_rent / income_for_burden,\n    rent_burden = case_when(\n      is.na(rent_to_income) ~ NA_character_,\n      rent_to_income &lt; 0.30 ~ \"Not Rent Burdened\",\n      rent_to_income &lt; 0.50 ~ \"Moderately Rent Burdened\",\n      rent_to_income &gt;= 0.50 ~ \"Severely Rent Burdened\"\n    )\n  ) |&gt;\n  select(-`fw.x`, -`fw.y`)\n\n\nrenter23 &lt;- df23 |&gt;\n  mutate(\n    cost_burden = case_when(\n      rent_to_income &lt; 0.30 ~ \"Not burdened (&lt;30%)\",\n      rent_to_income &lt; 0.50 ~ \"Moderately burdened (30–49%)\",\n      rent_to_income &gt;= 0.50 ~ \"Severely burdened (50%+)\"\n    ),\n    tenure = \"Renter\"\n  ) |&gt;\n  filter(!is.na(cost_burden))\n\ncombined23 &lt;- bind_rows(\n  renter23 |&gt; select(tenure, cost_burden, fw),\n  owner23  |&gt; select(tenure, cost_burden, fw)\n)\n\nplot_df &lt;- combined23 |&gt;\n  group_by(tenure, cost_burden) |&gt;\n  summarise(wt = sum(fw, na.rm = TRUE), .groups = \"drop\") |&gt;\n  group_by(tenure) |&gt;\n  mutate(pct = wt / sum(wt)) |&gt;\n  ungroup()\n\n\n\n\nCode\n# Plot4.1: Housing cost burden by owner and renter\nplot_df$cost_burden &lt;- factor(\n  plot_df$cost_burden,\n  levels = c(\n    \"Severely burdened (50%+)\",\n    \"Moderately burdened (30–49%)\",\n    \"Not burdened (&lt;30%)\"\n  )\n)\n\nggplot(plot_df, aes(x = tenure, y = pct, fill = cost_burden)) +\n  geom_col(position = \"fill\", color = \"black\", width = 0.6) +\n  scale_y_continuous(labels = percent_format()) +\n  scale_fill_manual(\n    values = c(\n      \"Not burdened (&lt;30%)\"         = cividis(3)[1],\n      \"Moderately burdened (30–49%)\" = cividis(3)[2],\n      \"Severely burdened (50%+)\"    = \"red\"\n    )\n  ) +\n  labs(\n    title = \"Housing Cost Burden Composition in 2023\",\n    subtitle = \"Owners with mortgages vs Renters \",\n    x = \"\",\n    y = \"Percent of Households\",\n    fill = \"Cost Burden Level\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"right\",\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\nThis stacked bar chart compares housing cost burden between homeowners with mortgages and renters in 2023. A clear difference appears between the two groups. Among homeowners with mortgages, about three-quarters of households fall into the “not burdened” category, meaning they spend less than 30% of their income on housing. Only a relatively small share of mortgage holders are moderately or severely burdened. In contrast, renters experience much higher housing cost pressure. Only about half of renter households are not burdened, while the remaining half are either moderately or severely burdened. Most notably, the share of renters who are severely burdened is substantially higher than that of homeowners with mortgages. Overall, this figure shows that renters face much greater housing affordability challenges than homeowners in 2023. Even without making causal claims, the descriptive pattern clearly indicates that housing cost burdens are unevenly distributed across tenure types, with renters being significantly more vulnerable to high housing expenses.\n\n\nCode\nowner23 &lt;- owner23 |&gt;\n  mutate(\n    income_bracket = factor(\n      income_bracket,\n      levels = c(\"&lt;$25k\", \"$25k–$49k\", \"$50k–$99k\", \"$100k+\")\n    )\n  )\n\nplot_df_owner &lt;- owner23 |&gt;\n  group_by(income_bracket, cost_burden) |&gt;\n  summarise(wt = sum(fw, na.rm = TRUE), .groups = \"drop_last\") |&gt;\n  group_by(income_bracket) |&gt;\n  mutate(\n    pct = wt / sum(wt)\n  ) |&gt;\n  ungroup()\n\nplot_df_owner\n\n\n# A tibble: 11 × 4\n   income_bracket cost_burden                       wt    pct\n   &lt;fct&gt;          &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt;\n 1 &lt;$25k          Moderately burdened (30–49%)    458. 0.0130\n 2 &lt;$25k          Severely burdened (50%+)      34679. 0.987 \n 3 $25k–$49k      Moderately burdened (30–49%)   6836. 0.228 \n 4 $25k–$49k      Not burdened (&lt;30%)            4879. 0.163 \n 5 $25k–$49k      Severely burdened (50%+)      18263. 0.609 \n 6 $50k–$99k      Moderately burdened (30–49%)  19857. 0.272 \n 7 $50k–$99k      Not burdened (&lt;30%)           38980. 0.533 \n 8 $50k–$99k      Severely burdened (50%+)      14239. 0.195 \n 9 $100k+         Moderately burdened (30–49%)  18729. 0.0632\n10 $100k+         Not burdened (&lt;30%)          268866. 0.908 \n11 $100k+         Severely burdened (50%+)       8516. 0.0288\n\n\n\n\nCode\n# Plot4.2: housing burden vs. household income for owner\nggplot(plot_df_owner,\n       aes(x = income_bracket, y = pct, group = cost_burden)) +\n  geom_line(aes(color = cost_burden), size = 1.3) +\n  geom_point(aes(color = cost_burden), size = 4) +\n  geom_text(\n    aes(label = percent(pct, accuracy = 1), color = cost_burden),\n    vjust = -0.8, size = 4\n  ) +\n  scale_y_continuous(labels = percent_format()) +\n  scale_color_manual(\n    values = c(\n      \"Severely burdened (50%+)\"         = \"red\",\n      \"Moderately burdened (30–49%)\"     = cividis(3)[2],\n      \"Not burdened (&lt;30%)\"              = cividis(3)[1]\n    )\n  ) +\n  labs(\n    title = \"Mortgage Burden Across Income Groups, 2023\",\n    x = \"Household Income Bracket\",\n    y = \"Percent of Owner Households\",\n    color = \"Mortgage Cost Burden Level\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"right\",\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\nAcross income groups, both charts show a very similar overall pattern: as household income increases, the share of households experiencing severe cost burden drops sharply, while the share of households who are not burdened rises. This suggests that income is the primary factor shaping housing affordability for both renters and owners. However, when we compare the two groups more closely, we observe an important difference: at every income level, owners with mortgages face much lower severe cost burden rates than renters. This gap implies that owning a home, even with a mortgage, generally provides more stability and protection against extreme housing cost stress. Homeowners benefit from more predictable payments and may have locked in lower mortgage rates, while renters are exposed to faster rent increases and market volatility. At the same time, moderate burden levels stay relatively stable across income for both groups, suggesting that the main shift with higher income is not a reduction in moderate stress, but rather a movement out of severe stress into the “not burdened” category. Overall, these patterns reinforce a key insight: income strongly improves affordability, but renters remain more financially vulnerable than owners. This highlights how tenure type—renting versus owning—plays a structural role in shaping economic security, even among households with similar incomes.\n\n\nCode\nplot_df2 &lt;- df23 |&gt;\n  filter(!is.na(rent_burden), !is.na(income_bracket)) |&gt;\n  group_by(income_bracket, rent_burden) |&gt;   # group order swapped\n  summarise(wt = sum(fw, na.rm = TRUE), .groups = \"drop_last\") |&gt; \n  group_by(income_bracket) |&gt;                # HERE is the difference\n  mutate(pct = wt / sum(wt)) |&gt;              # denominator = total in that income bracket\n  ungroup() |&gt;\n  mutate(\n    income_bracket = factor(\n      income_bracket,\n      levels = c(\"&lt;25k\", \"25k-49k\", \"50k-99k\", \"100k+\"),\n      ordered = TRUE\n    )\n  )\n\nplot_df2\n\n\n# A tibble: 12 × 4\n   income_bracket rent_burden                   wt    pct\n   &lt;ord&gt;          &lt;chr&gt;                      &lt;dbl&gt;  &lt;dbl&gt;\n 1 100k+          Moderately Rent Burdened  70415. 0.0843\n 2 100k+          Not Rent Burdened        753936. 0.902 \n 3 100k+          Severely Rent Burdened    11247. 0.0135\n 4 25k-49k        Moderately Rent Burdened 120808. 0.340 \n 5 25k-49k        Not Rent Burdened         76937. 0.217 \n 6 25k-49k        Severely Rent Burdened   157527. 0.443 \n 7 50k-99k        Moderately Rent Burdened 199007. 0.341 \n 8 50k-99k        Not Rent Burdened        324608. 0.557 \n 9 50k-99k        Severely Rent Burdened    59343. 0.102 \n10 &lt;25k           Moderately Rent Burdened  38034. 0.0991\n11 &lt;25k           Not Rent Burdened         40664. 0.106 \n12 &lt;25k           Severely Rent Burdened   305200. 0.795 \n\n\n\n\nCode\n# Plot4.3: housing burden vs. household income for renter\nggplot(plot_df2,\n       aes(x = income_bracket, y = pct, group = rent_burden)) +\n  geom_line(aes(color = rent_burden), size = 1.3) +\n  geom_point(aes(color = rent_burden), size = 4) +\n  geom_text(aes(label = percent(pct, accuracy = 1),\n                color = rent_burden),\n            vjust = -0.8, size = 4) +\n  scale_y_continuous(labels = percent_format()) +\n  scale_color_manual(\n    values = c(\n      \"Severely Rent Burdened\"   = \"red\",\n      \"Moderately Rent Burdened\" = cividis(3)[2],\n      \"Not Rent Burdened\"        = cividis(3)[1]\n    )\n  ) +\n  labs(\n    title = \"Rent Burden Across Income Groups, 2023\",\n    x = \"Household Income Bracket\",\n    y = \"Percent of Renter Households\",\n    color = \"Rent Cost Burden Level\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"right\",\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\nThis figure compares the growth of the rent index and the household income index in New York City, with both series normalized to 100 in 1991. From 1991 to around 2008, rent and income increased at almost the same pace, meaning affordability stayed relatively stable. After the 2008 financial crisis, rent growth slowed down noticeably, and between 2008 and 2017 income even grew a bit faster than rent. This period may reflect the broader economic recovery, when wage growth slightly outpaced housing cost increases. However, the pattern changes clearly after 2017. Rent begins to rise more quickly, and the gap becomes especially large in the most recent years. From 2021 to 2023, during the post-pandemic period, rent increases sharply while income grows much more slowly. This creates the largest divergence in the entire time series. Overall, the figure suggests that major economic events—such as the 2008 recession and the COVID-19 pandemic—played an important role in shaping the relationship between rent and income. While rent and income once moved together, recent years show a clear disconnect, with rent growth far outpacing income growth. This widening gap helps explain the higher rent burdens observed across many income groups in 2023.\n\n\nCode\nperson21_clean &lt;- person21 |&gt;\n  mutate(\n    total_inc_p = na_if(total_inc_rec_p, -2222222222)   # remove non-applicable income\n  )\n\nocc21_clean &lt;- occ21 |&gt;\n  mutate(\n    rent_amount = na_if(rent_amount, -2)            # remove non-applicable rent\n  )\n\nincome_household21 &lt;- person21_clean |&gt;\n  group_by(control) |&gt;\n  summarise(\n    hh_income = sum(total_inc_p, na.rm = TRUE),\n    fw = first(pw),           # household sampling weight\n    .groups = \"drop\"\n  )\n\nboro_lookup21 &lt;- puf21 |&gt; \n  select(control, boro) |&gt; \n  distinct()\n\ndf21 &lt;- occ21_clean |&gt;\n  select(control, rent_amount) |&gt; \n  left_join(boro_lookup21, by = \"control\") |&gt; # you said you only need fw, rent, and income\n  left_join(income_household21, by = \"control\")\n\ndf21 &lt;- df21 |&gt;\n  mutate(\n    annual_rent = rent_amount * 12,\n    income_for_burden = if_else(\n      hh_income &lt;= 0 | is.na(hh_income),\n      NA_real_,\n      hh_income\n    ),\n    rent_to_income = annual_rent / income_for_burden,\n\n    rent_burden = case_when(\n      is.na(rent_to_income) ~ NA_character_,\n      rent_to_income &lt; 0.30 ~ \"Not Rent Burdened\",\n      rent_to_income &lt; 0.50 ~ \"Moderately Rent Burdened\",\n      rent_to_income &gt;= 0.50 ~ \"Severely Rent Burdened\"\n    )\n  )\n\ndf21\n\n\n# A tibble: 7,089 × 9\n    control rent_amount  boro hh_income    fw annual_rent income_for_burden\n      &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;             &lt;dbl&gt;\n 1 12100003         228     1      2000  154.        2736              2000\n 2 12100005        1172     2      3696  265.       14064              3696\n 3 12100008        2100     4     65480  431.       25200             65480\n 4 12100010        1065     3     30000  200.       12780             30000\n 5 12100013        1169     4     10000 1195.       14028             10000\n 6 12100015        1000     5     68366  432.       12000             68366\n 7 12100016        1529     1     12800  442.       18348             12800\n 8 12100018         250     1         0  154.        3000                NA\n 9 12100022        1500     1     10400  442.       18000             10400\n10 12100038         607     2     15600  446.        7284             15600\n# ℹ 7,079 more rows\n# ℹ 2 more variables: rent_to_income &lt;dbl&gt;, rent_burden &lt;chr&gt;\n\n\n\n\nCode\ndf_91_17_clean &lt;- occ_before |&gt;\n  mutate(\n    inc  = as.numeric(inc),\n    rent = as.numeric(rent),\n    year = as.numeric(year)\n  ) |&gt;\n  mutate(\n    # Rent cleaning by year\n    rent = case_when(\n      year == 1991  & rent %in% c(9999, 9998) ~ NA_real_,\n      year &lt;= 2010  & rent == 9999            ~ NA_real_,\n      year &gt;= 2011  & rent == 99999           ~ NA_real_,\n      TRUE ~ rent\n    ),\n    # Income cleaning by year\n    inc = case_when(\n      # 1996 & earlier → 999999 means no income\n      year &lt;= 1996 & inc == 999999  ~ 0,\n      # 2002 & earlier → 9999999 means no income\n      year &lt;= 2002 & inc == 9999999 ~ 0,\n      # Other \"bad\" income codes\n      inc &gt; 999997 ~ NA_real_,\n      TRUE ~ inc\n    )\n  )\n\ndf_91_17 &lt;- df_91_17_clean |&gt;\n  group_by(year, boro) |&gt;\n  summarise(\n    rent = weighted.mean(rent, fw, na.rm = TRUE),\n    inc  = weighted.mean(inc,  fw, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# year of 2021\ndf21_boro &lt;- df21 |&gt;\n  group_by(boro) |&gt;\n  summarise(\n    rent = weighted.mean(rent_amount, fw, na.rm = TRUE),\n    inc  = weighted.mean(income_for_burden, fw, na.rm = TRUE)\n  ) |&gt;\n  mutate(year = 2021)\n\n# year of 2023 \ndf23_boro &lt;- df23 |&gt;\n  group_by(boro) |&gt;\n  summarise(\n    rent = weighted.mean(rent_amount, fw, na.rm = TRUE),\n    inc  = weighted.mean(income_for_burden, fw, na.rm = TRUE)\n  ) |&gt;\n  mutate(year = 2023)\n\n# all\ndfall_boro &lt;- bind_rows(\n  df_91_17,\n  df21_boro,\n  df23_boro\n) |&gt;\n  arrange(boro, year)\n\ndfall_boro_index &lt;- dfall_boro |&gt;\n  group_by(boro) |&gt;\n  mutate(\n    rent_index = rent / rent[year == 1991] * 100,\n    inc_index  = inc  / inc[year == 1991] * 100,\n    rti = rent / inc\n  ) |&gt;\n  ungroup()\n\ndfall_boro_index\n\n\n# A tibble: 55 × 7\n    year  boro  rent    inc rent_index inc_index    rti\n   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;\n 1  1991     1  454. 24660.       100       100  0.0184\n 2  1993     1  495. 25431.       109.      103. 0.0195\n 3  1996     1  570. 28132.       126.      114. 0.0203\n 4  2002     1  699. 36737.       154.      149. 0.0190\n 5  2005     1  817. 40033.       180.      162. 0.0204\n 6  2008     1  941. 44122.       207.      179. 0.0213\n 7  2011     1 1062. 44431.       234.      180. 0.0239\n 8  2014     1 1148. 46285.       253.      188. 0.0248\n 9  2017     1 1218. 50742.       268.      206. 0.0240\n10  2021     1 1174. 56878.       259.      231. 0.0206\n# ℹ 45 more rows\n\n\n\n\nCode\ndf_city &lt;- dfall_boro_index |&gt;\n  group_by(year) |&gt;\n  summarise(\n    rent_index = mean(rent_index, na.rm = TRUE),\n    inc_index  = mean(inc_index, na.rm = TRUE)\n  ) |&gt;\n  pivot_longer(\n    cols = c(rent_index, inc_index),\n    names_to = \"type\",\n    values_to = \"value\"\n  )\n\n\n\n\nCode\n# Plot4.4: Rent index vs. income index\ndf_city$year_f &lt;- factor(df_city$year)\nggplot(df_city, aes(x = year_f, y = value, color = type)) +\n  geom_line(linewidth = 1.2, aes(group = type)) +\n  geom_point(size = 2) +\n  scale_color_manual(\n    values = c(\"rent_index\" = cividis(3)[1], \"inc_index\" = \"red\"),\n    labels = c(\"Rent Index\", \"Income Index\")\n  ) +\n  labs(\n    title = \"NYC Rent Index vs. Income Index, 1991-2023\",\n    subtitle = \"1991 is normalized to index value that equals to 100\",\n    x = \"Year\",\n    y = \"Index\",\n    color = \"\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\n\nCode\ndfall_boro_index &lt;- dfall_boro_index |&gt;\n  mutate(boro = as.numeric(boro))\n\nrate_91_23 &lt;- rate_91_23 |&gt;\n  mutate(boro = as.numeric(boro))\n\ndf_all_boro_final &lt;- dfall_boro_index |&gt;\n  left_join(rate_91_23 |&gt; select(year, boro, vacancy_rate),\n            by = c(\"year\", \"boro\"))\ndf_all_boro_final &lt;- df_all_boro_final |&gt;\n  mutate(\n    boro = recode(boro,\n                       \"1\" = \"Bronx\",\n                       \"2\" = \"Brooklyn\",\n                       \"3\" = \"Manhattan\",\n                       \"4\" = \"Queens\",\n                       \"5\" = \"Staten Island\")\n  )\n\ndf_all_boro_final\n\n\n# A tibble: 55 × 8\n    year boro   rent    inc rent_index inc_index    rti vacancy_rate\n   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;\n 1  1991 Bronx  454. 24660.       100       100  0.0184      0.0334 \n 2  1993 Bronx  495. 25431.       109.      103. 0.0195      0.0330 \n 3  1996 Bronx  570. 28132.       126.      114. 0.0203      0.0442 \n 4  2002 Bronx  699. 36737.       154.      149. 0.0190      0.0260 \n 5  2005 Bronx  817. 40033.       180.      162. 0.0204      0.0206 \n 6  2008 Bronx  941. 44122.       207.      179. 0.0213      0.0259 \n 7  2011 Bronx 1062. 44431.       234.      180. 0.0239      0.0261 \n 8  2014 Bronx 1148. 46285.       253.      188. 0.0248      0.0303 \n 9  2017 Bronx 1218. 50742.       268.      206. 0.0240      0.0213 \n10  2021 Bronx 1174. 56878.       259.      231. 0.0206      0.00614\n# ℹ 45 more rows\n\n\n\n\nCode\n# Plot4.4: Housing affordabiltiy vs vacancy scatter\ncividis_pal &lt;- c(\n  # 深蓝（Bronx）\n  \"black\",\n  \"steelblue\",\n  \"darkred\",  \n  \"darkgreen\",  \n  \"#F6D65D\"\n)\n\nggplot(df_all_boro_final, \n       aes(x = rti, \n           y = vacancy_rate, \n           color = boro)) +\n\n  # Points\n  geom_point(size = 3, alpha = 0.8) +\n\n  # Year labels\n  geom_text(\n    aes(label = year),\n    hjust = -0.2, vjust = 0.5,\n    size = 3.2,\n    show.legend = FALSE\n  ) +\n\n  # Regression line (optional, for clarity)\n  geom_smooth(\n    method = \"lm\",\n    se = FALSE,\n    linetype = \"dashed\",\n    color = \"grey\"\n  ) +\n  scale_color_manual(values = cividis_pal, name = \"Borough\") +\n  labs(\n    title = \"NYC Housing Affordability vs. Vacancy Rate by Boroughs, 1991–2023\",\n    subtitle = \"Affordability measured as weighted rent-to-income ratio, each point is a borough-year observation\",\n    x = \"Affordability\",\n    y = \"Vacancy Rate\",\n    color = \"Borough\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"right\",\n    panel.grid.minor = element_blank()\n  )\n\n\n\n\n\n\n\n\n\nThis scatterplot compares borough-level affordability, measured by the weighted rent-to-income ratio, with vacancy rates from 1991 to 2023. Overall, the points show no strong linear relationship between the two variables. Most borough-year observations cluster within a narrow range of affordability (around 0.015–0.020) and vacancy rates (around 1.5%–3.5%). This suggests that New York City typically experiences high rent burden and low vacancy at the same time, rather than a simple tradeoff between the two. Manhattan’s 2021 observation stands out as a clear outlier, with both unusually high vacancy and high rent burden. This spike likely reflects the unique impact of the COVID-19 period rather than a long-term pattern. Outside of this event, the data do not show consistent evidence that higher vacancy corresponds to better affordability or that lower affordability coincides with higher vacancy. Different boroughs occupy somewhat distinct regions of the plot, with Staten Island generally appearing more affordable and Manhattan less affordable, but vacancy levels remain low across boroughs in most years. Overall, the figure highlights that affordability challenges in NYC cannot be explained simply by variations in vacancy rates.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Results</span>"
    ]
  },
  {
    "objectID": "conclusion.html",
    "href": "conclusion.html",
    "title": "4  Conclusion",
    "section": "",
    "text": "Overall, this project suggests that New York City’s housing problems come from long-term structural and macro-level forces, not just short-term market changes. Vacancy rates have stayed extremely low for more than thirty years, which means the city has a persistent housing supply constraint. At the same time, rents have grown much faster than household incomes—especially after 2010—creating a growing affordability gap that affects both low-income and many middle-income renters. This pattern reflects larger economic trends such as rising inequality, slower wage growth, and increasing demand for urban housing.\nOur analysis also shows that many “vacant” units are actually unavailable because of renovation, seasonal use, or legal and structural issues. This suggests that the tight rental market is structural, not the result of owners intentionally keeping units empty. The weak relationship between affordability and vacancy further shows that solving the affordability crisis will likely require increasing housing supply or addressing the imbalance between rent and income, rather than focusing only on vacancy rates. Even though the dataset has limitations—such as missing details for privacy and inconsistent variables across years—this project helped me understand how local housing patterns are shaped by broader economic forces. If I continued this work, I would bring in more macro-level indicators or compare NYC with other cities to understand how national economic trends influence local housing challenges.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Conclusion</span>"
    ]
  }
]